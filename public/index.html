<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>DropSource ‚Äî Boosts</title>
<style>
  :root{
    --bg:#0b0e13; --panel:#0f141b; --card:#141923; --ink:#e9edf1; --muted:#9aa4af;
    --outline:#1d2533; --ring:#2b3550; --chip:#223044; --chip-border:#2b3950;
    --geo:#2a1f3a; --geo-border:#3a2e58; --brand:#6e84ff; --price:#b38aff;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.35 system-ui,-apple-system,Segoe UI,Inter,Roboto}
  .wrap{max-width:1200px;margin:24px auto;padding:0 16px}
  .brandbar{display:flex;align-items:center;gap:10px;margin-bottom:12px}
  .brandbar img{width:28px;height:28px}
  h1{font-size:18px;margin:0}
  .toolbar{display:flex;gap:8px;align-items:center;margin:10px 0 14px}
  .btn{background:#11161d;color:var(--ink);border:1px solid var(--outline);border-radius:10px;padding:9px 12px;cursor:pointer}
  .btn:hover{border-color:var(--ring)}
  .search{flex:1}
  .search input{width:100%;background:var(--panel);border:1px solid var(--outline);border-radius:10px;padding:11px 12px;color:var(--ink)}
  .count{opacity:.7;margin:6px 0}

  /* category bar */
  .cats{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin:12px 0 16px}
  .cat{display:flex;align-items:center;gap:10px;background:#0f141b;border:1px solid var(--outline);padding:10px 12px;border-radius:14px;cursor:pointer;transition:transform .08s ease,border-color .12s ease,box-shadow .12s ease}
  .cat img{width:20px;height:20px;display:block}
  .cat span{font-weight:600}
  .cat:hover{transform:translateY(-1px)}
  .cat.active{box-shadow:0 0 0 2px var(--ring) inset}

  /* dynamically tinted on hover via data-color attr */
  .cat[data-color]:hover{border-color:currentColor; box-shadow:0 0 0 2px currentColor20 inset}
  /* currentColor20 gets set inline via style= --c: color; filter not needed */

  /* grid/cards */
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  @media (max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:640px){.grid{grid-template-columns:1fr}}

  .card{background:linear-gradient(180deg,#121722,#0f131c 65%);border:1px solid var(--outline);border-radius:16px;padding:14px;position:relative}
  .title{font-weight:800;margin:0 0 8px 0}
  .title .ds{color:var(--brand)}
  .meta{display:flex;gap:6px;flex-wrap:wrap;margin:8px 0}
  .chip{font-size:12px;color:#cfd6de;background:var(--chip);border:1px solid var(--chip-border);padding:3px 8px;border-radius:999px}
  .chip.geo{background:var(--geo);border-color:var(--geo-border)}
  .pill{font-size:12px;padding:3px 8px;border-radius:999px;border:1px solid var(--outline);background:#121623;color:#cfd6de}
  .price{font-weight:800;margin-top:6px;color:var(--price)}
  .row{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:10px}
  .row .btn.primary{background:linear-gradient(90deg,#6e84ff,#b38aff);border-color:#3a4370}
  .flag{position:absolute;top:10px;right:10px;padding:4px 8px;border-radius:999px;border:1px solid var(--outline);background:#1b2233;color:#dcdfff;font-size:12px}
  .foot{opacity:.6;text-align:center;margin:32px 0 10px}
  .error{color:#ff7b7b;margin:8px 0;display:none}

  /* tiny utility for dynamic hover color */
  .cat{color:var(--ink)}
  .cat[style]{box-shadow:0 0 0 1px color-mix(in srgb, var(--c) 20%, transparent) inset}
  .cat:hover[style]{box-shadow:0 0 0 2px var(--c) inset}
</style>
</head>
<body>
  <div class="wrap">
    <div class="brandbar">
      <img src="/icons/allproducts.svg" alt="">
      <h1>DropSource ‚Ä¢ Boosts</h1>
    </div>

    <div class="toolbar">
      <button class="btn" id="all">All</button>
      <button class="btn" id="sortPrice">Sort: Price ‚Üë</button>
      <div class="search"><input id="q" placeholder="Search services..."></div>
      <button class="btn" id="reload">Reload</button>
    </div>

    <div id="cats" class="cats"></div>

    <div id="error" class="error"></div>
    <div id="count" class="count"></div>
    <div id="grid" class="grid"></div>

    <div class="foot">Powered by <span style="color:var(--brand);font-weight:700">DropSource</span> ‚Äî your growth plug, but like‚Ä¶ responsibly ‚úåÔ∏è</div>
  </div>

<script>
/* ====== CONFIG: platform colors + icons ====== */
const PLATFORM = {
  instagram: { label:'Instagram', color:'#E1306C', icon:'instagram.svg' },
  tiktok:    { label:'TikTok',    color:'#00F2EA', icon:'tiktok.svg' },
  youtube:   { label:'YouTube',   color:'#FF0000', icon:'youtube.svg' },
  twitter:   { label:'X (Twitter)',color:'#8899A6',icon:'twitter.svg' },
  x:         { label:'X (Twitter)',color:'#8899A6',icon:'twitter.svg' },
  facebook:  { label:'Facebook',  color:'#1877F2', icon:'facebook.svg' },
  snapchat:  { label:'Snapchat',  color:'#FFFC00', icon:'snapchat.svg' },
  spotify:   { label:'Spotify',   color:'#1DB954', icon:'spotify.svg' },
  soundcloud:{ label:'SoundCloud',color:'#FF7700', icon:'soundcloud.svg' },
  pinterest: { label:'Pinterest', color:'#E60023', icon:'pinterest.svg' },
  telegram:  { label:'Telegram',  color:'#229ED9', icon:'telegram.svg' },
  twitch:    { label:'Twitch',    color:'#9146FF', icon:'twitch.svg' },
  reddit:    { label:'Reddit',    color:'#FF4500', icon:'reddit.svg' },
  linkedin:  { label:'LinkedIn',  color:'#0A66C2', icon:'linkedin.svg' },
  mixcloud:  { label:'Mixcloud',  color:'#52aad8', icon:'mixcloud.svg' },
  okru:      { label:'OK.ru',     color:'#EE8208', icon:'okru.svg' },
  ownwebsite:{ label:'Own Website', color:'#8aa0ff', icon:'ownwebsite.svg' },
  website:   { label:'Website',   color:'#8aa0ff', icon:'ownwebsite.svg' },
  traffic:   { label:'Web Traffic', color:'#7e8cff', icon:'webtraffic.svg' },
  other:     { label:'Other',     color:'#9aa4af', icon:'other.svg' },
};

function pickPlatform(svc){
  const hay = `${svc.category||''} ${svc.name||''}`.toLowerCase();
  for (const key of Object.keys(PLATFORM)) {
    if (hay.includes(key)) return key;
  }
  // fallbacks for common labels found in your feed
  if (hay.includes('own website')) return 'ownwebsite';
  if (hay.includes('webtraffic') || hay.includes('mobile traffic') || hay.includes('worldwide traffic')) return 'traffic';
  return 'other';
}

function isGeoTag(label){
  const L = String(label||'').toLowerCase();
  return ['usa','uk','korea','india','brazil','mexico','turkey','russia','indonesia','italy','france','germany','uae','saudi','japan','spain','canada','global','worldwide'].some(c => L.includes(c));
}

/* ====== UI state ====== */
const grid   = document.getElementById('grid');
const catsEl = document.getElementById('cats');
const errBox = document.getElementById('error');
const count  = document.getElementById('count');
const q      = document.getElementById('q');

let ALL = [];
let VIEW = [];
let CURRENT_FILTER = 'all';
let PRICE_ASC = true;

/* ====== renderers ====== */
function renderCategories(services){
  // collect first-platform counts
  const tally = {};
  for (const s of services){
    const key = pickPlatform(s);
    tally[key] = (tally[key]||0) + 1;
  }

  // build list with ‚Äúall‚Äù first
  const items = [{ key:'all', label:'All Products', color:'#6e84ff', icon:'allproducts.svg', count: services.length }];
  for (const [key,count] of Object.entries(tally)){
    const cfg = PLATFORM[key] || PLATFORM.other;
    items.push({ key, label: cfg.label, color: cfg.color, icon: cfg.icon, count });
  }

  catsEl.innerHTML = '';
  for (const it of items){
    const div = document.createElement('div');
    div.className = 'cat';
    div.dataset.key = it.key;
    div.dataset.color = it.color;
    div.style.setProperty('--c', it.color);
    div.innerHTML = `<img src="/icons/${it.icon}" alt=""><span>${it.label}</span><span style="margin-left:auto;opacity:.7">${it.count}</span>`;
    if (it.key === CURRENT_FILTER) div.classList.add('active');
    div.onclick = () => { CURRENT_FILTER = it.key; applyFilter(); renderCategories(ALL); };
    catsEl.appendChild(div);
  }
}

function cardFor(svc){
  const div = document.createElement('div');
  div.className = 'card';

  const title = document.createElement('div');
  title.className = 'title';
  title.innerHTML = `<span class="ds">[DropSource]</span> ‚Äî ${escapeHtml(svc.name)}`;
  div.appendChild(title);

  const meta = document.createElement('div');
  meta.className = 'meta';
  const tags = (svc.tags||[]).slice(0,8);
  if (svc.min) tags.unshift(`Min ${svc.min}`);
  if (svc.max) tags.unshift(`Max ${svc.max}`);
  for (const t of tags){
    const chip = document.createElement('span');
    chip.className = 'chip' + (isGeoTag(t) ? ' geo' : '');
    chip.textContent = t;
    meta.appendChild(chip);
  }
  div.appendChild(meta);

  const price = document.createElement('div');
  price.className = 'price';
  price.textContent = svc.price ? `$${(+svc.price).toFixed(2)} / 1k` : '‚Äî';
  div.appendChild(price);

  const row = document.createElement('div');
  row.className = 'row';
  const view = document.createElement('button');
  view.className = 'btn';
  view.textContent = 'View variants';
  const order = document.createElement('button');
  order.className = 'btn primary';
  order.textContent = 'Order cheapest';
  order.onclick = () => alert('Hook this up to your order flow ü§ô');
  row.appendChild(view); row.appendChild(order);
  div.appendChild(row);

  const platKey = pickPlatform(svc);
  const cfg = PLATFORM[platKey] || PLATFORM.other;
  const flag = document.createElement('div');
  flag.className = 'flag';
  flag.textContent = cfg.label;
  flag.style.borderColor = 'color-mix(in srgb, '+cfg.color+' 55%, transparent)';
  flag.style.background = 'color-mix(in srgb, '+cfg.color+' 18%, #101827)';
  div.appendChild(flag);

  return div;
}

function render(list){
  grid.innerHTML = '';
  count.textContent = `${list.length.toLocaleString()} services`;
  for (const s of list) grid.appendChild(cardFor(s));
}

/* ====== logic ====== */
function escapeHtml(x){return String(x||'').replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]))}

function applyFilter(){
  const term = q.value.trim().toLowerCase();

  // base set
  let arr = [...ALL];

  // category filter
  if (CURRENT_FILTER !== 'all'){
    arr = arr.filter(s => pickPlatform(s) === CURRENT_FILTER);
  }

  // text search
  if (term){
    arr = arr.filter(s =>
      (s.name||'').toLowerCase().includes(term) ||
      (s.category||'').toLowerCase().includes(term) ||
      (s.tags||[]).some(t => String(t).toLowerCase().includes(term))
    );
  }

  // price sort
  arr.sort((a,b)=> PRICE_ASC ? ((a.price||0)-(b.price||0)) : ((b.price||0)-(a.price||0)));

  VIEW = arr;
  render(VIEW);
}

async function load(){
  errBox.style.display='none'; errBox.textContent='';
  try{
    const res = await fetch('/api/smm');
    if(!res.ok){ throw new Error(`API ${res.status}`); }
    const json = await res.json();
    ALL = Array.isArray(json) ? json : [];
    // normalize weird categories like ‚ÄúWebTraffic Geo Targeted‚Äù to show up under traffic
    renderCategories(ALL);
    applyFilter();
  }catch(e){
    errBox.textContent = 'Load error: '+(e.message||e);
    errBox.style.display='block';
  }
}

/* ====== events ====== */
document.getElementById('reload').onclick = load;
document.getElementById('all').onclick = () => { CURRENT_FILTER='all'; applyFilter(); renderCategories(ALL); };
document.getElementById('sortPrice').onclick = (ev)=>{
  PRICE_ASC = !PRICE_ASC;
  ev.currentTarget.textContent = `Sort: Price ${PRICE_ASC?'‚Üë':'‚Üì'}`;
  applyFilter();
};
q.addEventListener('input', applyFilter);

/* kick it */
load();
</script>
</body>
</html>