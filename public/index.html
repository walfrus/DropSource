<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>DropSource • Boosts</title>
  <style>
    :root{
      --bg:#0b0e13; --panel:#0f141b; --card:#151a21;
      --ink:#e9edf1; --muted:#9aa4af;
      --brand:#5b8cff; --brand2:#ac82ff;
      --chip:#223044; --chip-border:#2b3950;
      --chip-geo:#2a1f3a; --chip-geo-border:#3a2e58;
      --ring:#2a3350;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Inter}
    .wrap{max-width:1200px;margin:24px auto;padding:0 16px}
    .brandbar{display:flex;align-items:center;gap:10px;margin-bottom:14px}
    .brandbar img{width:26px;height:26px}
    h1{font-size:18px;margin:0}
    .toolbar{display:flex;gap:8px;align-items:center;margin:8px 0 14px}
    .btn{background:#11161d;color:var(--ink);border:1px solid #1c2330;border-radius:8px;padding:8px 12px;cursor:pointer}
    .btn:hover{border-color:var(--ring)}
    .search{flex:1}
    .search input{width:100%;background:var(--panel);border:1px solid #1c2330;border-radius:8px;padding:10px 12px;color:var(--ink)}
    .count{opacity:.7;margin:6px 0}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width:920px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}

    .card{background:linear-gradient(180deg,#121720, #0f131a 70%);
      border:1px solid #1a202b;border-radius:14px;padding:14px;position:relative;
      box-shadow:0 0 0 1px rgba(91,140,255,.07) inset}
    .title{font-weight:700;margin-bottom:8px}
    .meta{display:flex;gap:6px;flex-wrap:wrap;margin:8px 0}
    .chip{font-size:12px;color:#cfd6de;background:var(--chip);border:1px solid var(--chip-border);
      padding:3px 8px;border-radius:999px}
    .chip.geo{background:var(--chip-geo);border-color:var(--chip-geo-border)}
    .price{font-weight:700;margin-top:6px}
    .row{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:10px}
    .row .btn{padding:8px 10px;border-radius:8px;border:1px solid #223047;background:#111722;color:#e8eef6}
    .row .btn.primary{background:linear-gradient(90deg,var(--brand),var(--brand2));border-color:#3a4370}
    .flag{position:absolute;top:10px;right:10px;padding:4px 8px;border-radius:999px;border:1px solid #3a2e58;background:#1b1330;color:#dcd4ff;font-size:12px}
    .foot{opacity:.6;text-align:center;margin:32px 0 10px}
    .error{color:#ff7b7b;margin:8px 0;display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="brandbar">
      <!-- Icons live at /icons/*.svg (i.e., public/icons/allproducts.svg) -->
      <img src="/icons/allproducts.svg" alt="All products">
      <h1>DropSource • Boosts</h1>
    </div>

    <div class="toolbar">
      <button class="btn" id="all">All products</button>
      <button class="btn" id="expand">Expand all</button>
      <button class="btn" id="collapse">Collapse all</button>
      <button class="btn" id="inline">Show variants inline</button>
      <div class="search"><input id="q" placeholder="Search services..."></div>
      <button class="btn" id="reload">Reload</button>
    </div>

    <div id="error" class="error"></div>
    <div id="count" class="count"></div>
    <div id="grid" class="grid"></div>

    <div class="foot">Powered by DropSource — your growth plug, but like… responsibly ✌️</div>
  </div>

<script>
const grid = document.getElementById('grid');
const errBox = document.getElementById('error');
const count = document.getElementById('count');
const q = document.getElementById('q');

let ALL = [];
let VIEW = [];

function chip(txt, geo=false){
  const s = document.createElement('span');
  s.className = 'chip' + (geo ? ' geo':'');
  s.textContent = txt;
  return s;
}

function isGeoTag(label){
  const L = label.toLowerCase();
  return [
    'usa','united states','uk','united kingdom','korea','india','brazil','mexico','turkey','russia',
    'indonesia','italy','france','germany','uae','saudi','japan','spain','canada','global','worldwide'
  ].some(c => L.includes(c));
}

function render(list){
  grid.innerHTML = '';
  count.textContent = `${list.length.toLocaleString()} services`;

  for(const svc of list){
    const card = document.createElement('div');
    card.className = 'card';

    const t = document.createElement('div');
    t.className = 'title';
    t.textContent = `[DropSource] — ${svc.name}`;
    card.appendChild(t);

    const meta = document.createElement('div');
    meta.className = 'meta';
    const tags = svc.tags || [];
    for(const tag of tags.slice(0,8)){
      meta.appendChild(chip(tag, isGeoTag(tag)));
    }
    card.appendChild(meta);

    const price = document.createElement('div');
    price.className = 'price';
    price.textContent = svc.price ? `$${(+svc.price).toFixed(2)} / 1k` : '—';
    card.appendChild(price);

    const row = document.createElement('div');
    row.className = 'row';
    const v = document.createElement('button');
    v.className = 'btn';
    v.textContent = 'View variants';
    const o = document.createElement('button');
    o.className = 'btn primary';
    o.textContent = 'Order cheapest';
    row.appendChild(v); row.appendChild(o);
    card.appendChild(row);

    if(svc.category){
      const f = document.createElement('div');
      f.className = 'flag';
      f.textContent = svc.category;
      card.appendChild(f);
    }

    grid.appendChild(card);
  }
}

function applyFilter() {
  const term = q.value.trim().toLowerCase();
  if(!term){ VIEW = [...ALL]; }
  else {
    VIEW = ALL.filter(s =>
      (s.name||'').toLowerCase().includes(term) ||
      (s.category||'').toLowerCase().includes(term) ||
      (s.tags||[]).some(t => String(t).toLowerCase().includes(term))
    );
  }
  // default sort: price asc
  VIEW.sort((a,b)=> (a.price||0)-(b.price||0));
  render(VIEW);
}

async function load(){
  errBox.style.display='none';
  errBox.textContent='';
  grid.innerHTML=''; count.textContent='';
  try{
    // This calls your serverless function file: api/smm.ts
    const res = await fetch('/api/smm');
    if(!res.ok){
      const txt = await res.text();
      throw new Error(`API ${res.status}: ${txt}`);
    }
    const json = await res.json();
    // Expecting array of mapped services from smm.ts
    ALL = Array.isArray(json) ? json : [];
    applyFilter();
  }catch(e){
    errBox.textContent = 'Load error: ' + (e?.message || e);
    errBox.style.display='block';
  }
}

document.getElementById('reload').onclick = load;
q.addEventListener('input', applyFilter);

load();
</script>
</body>
</html>