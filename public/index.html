<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DropSource — Boosts</title>
<style>
  :root{
    --bg:#0b0b0f; --card:#15161a; --txt:#e8ecf1; --muted:#a6acb3; --rule:#26282d;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--txt);font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto}
  header{padding:24px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between;border-bottom:1px solid var(--rule)}
  .container{max-width:1100px;margin:0 auto;padding:16px}
  input,button{font:inherit}
  input{background:#11131a;border:1px solid #2a2d34;color:var(--txt);padding:10px 12px;border-radius:10px}
  .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:8px 0 12px}
  .toolbar button{background:#0f1117;border:1px solid #2a2d34;color:var(--txt);padding:8px 12px;border-radius:10px;cursor:pointer}
  .toolbar .count{color:var(--muted);font-size:12px}

  /* sections */
  .section{border-radius:14px;overflow:hidden;margin-bottom:16px}
  .section-header{
    display:flex;align-items:center;gap:10px;padding:12px 14px;cursor:pointer;
    background:linear-gradient(180deg,#1a1b2a,#141524); border:1px solid #26273a;border-radius:14px;
  }
  .section-header img{width:18px;height:18px}
  .section-title{font-weight:600;text-transform:capitalize}
  .section-meta{margin-left:auto;color:var(--muted);font-size:12px}
  .chev{transition:.15s transform}
  .collapsed .chev{transform:rotate(-90deg)}
  .section-body{padding:12px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}

  /* cards */
  .card{
    position:relative;border-radius:18px;padding:18px 16px 52px;
    background:#15161a;border:1px solid #2b2d3d;
    box-shadow:0 0 0 1px rgba(255,255,255,.02) inset, 0 8px 20px rgba(0,0,0,.35);
    transition: transform .08s ease, box-shadow .12s ease, border-color .12s ease;
  }
  .card:hover{
    transform:translateY(-2px);
    border-color:#3a3d57;
    box-shadow:0 0 0 1px rgba(255,255,255,.03) inset, 0 12px 30px rgba(0,0,0,.45), 0 0 0 3px var(--ring, rgba(139,92,246,.35));
  }
  .card h3{margin:0 0 8px 0;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .muted{color:var(--muted)}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

  .pill{
    padding:3px 8px;border-radius:999px;font-size:12px;color:#fff;
    background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(0,0,0,.08));
    border:1px solid #2b2d3d;
  }

  /* price badge */
  .price-badge{
    position:absolute;left:14px;bottom:12px;padding:6px 10px;border-radius:10px;
    background:color-mix(in srgb,var(--t,#8b5cf6) 18%,#0f1020);
    border:1px solid color-mix(in srgb,var(--t,#8b5cf6) 30%,#343654);
    font-weight:700;box-shadow:0 4px 16px rgba(0,0,0,.4);
  }
  .price-badge .per{color:var(--muted);font-weight:500;margin-left:4px}

  /* buttons */
  .btn{
    padding:8px 12px;border-radius:10px;border:1px solid #2b2d3d;
    background:#101221;color:#e8ecf1;cursor:pointer;
    transition:filter .12s ease, transform .05s ease;
  }
  .btn:hover{filter:brightness(1.07)}
  .btn:active{transform:translateY(1px)}
  .btn.primary{
    border-color:transparent;
    background:linear-gradient(180deg,
      color-mix(in srgb,var(--t) 22%,#0f1020),
      color-mix(in srgb,var(--t) 10%,#0b0c16));
  }
  .btn.ghost{
    background:transparent;
    border-color:color-mix(in srgb,var(--t) 35%,#2b2d3d);
  }

  /* modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:flex-start;justify-content:center;padding:40px 16px;z-index:50}
  .modal{width:min(900px,100%);background:#0f1119;border:1px solid #2a2d34;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.6);overflow:hidden}
  .modal header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid #222532}
  .modal header h4{margin:0;font-size:16px}
  .modal .body{padding:12px 12px 16px;max-height:65vh;overflow:auto}
  table{width:100%;border-collapse:separate;border-spacing:0 8px}
  th,td{font-size:13px;text-align:left;padding:8px 10px;background:#141728;border:1px solid #25283a}
  th{position:sticky;top:0;background:#171a2b;z-index:1}
  tr td:first-child, tr th:first-child{border-top-left-radius:8px;border-bottom-left-radius:8px}
  tr td:last-child, tr th:last-child{border-top-right-radius:8px;border-bottom-right-radius:8px}

  .footer{opacity:.7;font-size:12px;padding:18px;text-align:center}
  #err{margin-top:12px;color:#ff6b6b;font-size:12px}
</style>
</head>
<body>
<header>
  <div><strong class="brand">DropSource</strong> · Boosts</div>
  <div class="row">
    <input id="q" placeholder="Search services…"/>
    <button id="reload">Reload</button>
  </div>
</header>

<div class="container">
  <div class="toolbar">
    <button id="expandAll">Expand all</button>
    <button id="collapseAll">Collapse all</button>
    <span class="count" id="totalCount"></span>
  </div>
  <div id="sections"></div>
  <div id="err"></div>
</div>

<!-- VARIANT MODAL -->
<div id="modalWrap" class="modal-backdrop" role="dialog" aria-modal="true">
  <div class="modal">
    <header>
      <h4 id="modalTitle">Variants</h4>
      <button id="modalClose" class="btn">Close</button>
    </header>
    <div class="body">
      <table>
        <thead>
          <tr>
            <th style="width:38%">Variant</th>
            <th>Tags</th>
            <th>Min</th>
            <th>Max</th>
            <th>Price /1k</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="variantRows"></tbody>
      </table>
    </div>
  </div>
</div>

<div class="footer">Powered by DropSource • your growth plug, but like… responsibly ✌️</div>

<script>
/* DOM */
const elQ = document.getElementById('q');
const elSections = document.getElementById('sections');
const elReload = document.getElementById('reload');
const elErr = document.getElementById('err');
const elTotal = document.getElementById('totalCount');
const elExpandAll = document.getElementById('expandAll');
const elCollapseAll = document.getElementById('collapseAll');
const modalWrap = document.getElementById('modalWrap');
const modalClose = document.getElementById('modalClose');
const modalTitle = document.getElementById('modalTitle');
const variantRows = document.getElementById('variantRows');

/* state */
let ALL_SERVICES = [];
let COLLAPSED = new Set();

/* icons + colors */
const ICON_PATHS = {
  instagram:'instagram.svg', tiktok:'tiktok.svg', youtube:'youtube.svg', facebook:'facebook.svg',
  twitter:'specialtwitter.svg', telegram:'telegram.svg', spotify:'spotify.svg', threads:'threads.svg',
  soundcloud:'soundcloud.svg', pinterest:'pinterest.svg', reddit:'reddit.svg', linkedin:'linkedin.svg',
  twitch:'twitch.svg', vk:'vkontakte.svg', okru:'okru.svg', audiomack:'audiomack.svg',
  reverbnation:'reverbnation.svg', tidal:'tidal.svg', shazam:'shazam.svg', dailymotion:'dailymotion.svg',
  datpiff:'datpiff.svg', mixcloud:'mixcloud.svg', rumble:'rumble.svg', imdb:'imdb.svg',
  maskedtraffic:'maskedtraffic.svg', websitepremium:'websitepremium.svg', webtraffic:'webtraffic.svg', other:'other.svg'
};
const ACCENTS = {
  instagram:'#e1306c', youtube:'#ff0033', tiktok:'#29bdb1', facebook:'#1877f2',
  twitter:'#1d9bf0', spotify:'#1db954', telegram:'#2aabee', threads:'#ffffff',
  soundcloud:'#ff5500', pinterest:'#e60023', reddit:'#ff4500', linkedin:'#0a66c2',
  twitch:'#9146ff', vk:'#4c75a3', okru:'#ed812b', audiomack:'#f2a900', reverbnation:'#e31e24',
  tidal:'#0a0a0a', shazam:'#08f', dailymotion:'#0066dc', datpiff:'#86c232',
  mixcloud:'#52aad8', rumble:'#85c742', imdb:'#f5c518', maskedtraffic:'#8b5cf6',
  websitepremium:'#a78bfa', webtraffic:'#8b5cf6', other:'#8b5cf6'
};
function platformOf(txt=''){txt=String(txt).toLowerCase();for(const k of Object.keys(ICON_PATHS)){if(txt.includes(k))return k;}return 'other';}
function accentFor(svc){return ACCENTS[platformOf(svc.category||svc.name||'')]||ACCENTS.other;}

/* feature chips */
const COUNTRY_WORDS = ['usa','uk','germany','france','italy','spain','canada','brazil','india','japan','korea','korean','turkey','mexico','australia','russia','uae','saudi','indonesia','vietnam','thailand','philippines'];
function chipListForName(name){
  const n=(name||'').toLowerCase(); const out=[];
  if(/\bultra\s*hq|premium/.test(n)) out.push('Premium');
  if(/\bhq\b|high\s*quality/.test(n)) out.push('HQ');
  if(/fast|instant|speed/i.test(n)) out.push('Fast');
  if(/cheapest|cheap/i.test(n)) out.push('Cheapest');
  if(/old\s*accounts?/i.test(n)) out.push('Old Accounts');
  if(/verified/i.test(n)) out.push('Verified');
  if(/real\b/.test(n)) out.push('Real');
  if(/\bgeo\b/i.test(n)) out.push('Geo');
  for(const c of COUNTRY_WORDS){ if(n.includes(c)){ out.push(c.toUpperCase()); break; } }
  return out;
}
function renderQualChips(s){
  const chips=[]; if(s.min) chips.push(`Min ${s.min}`); if(s.max) chips.push(`Max ${s.max}`);
  if(s.dripfeed) chips.push('Dripfeed'); if(s.refill) chips.push('Refill');
  return chips.concat(chipListForName(s.name));
}

/* product extraction */
const PRODUCT_WORDS=['Followers','Likes','Views','Comments','Subscribers','Saves','Story Views','Impressions','Shares','Plays','Streams','Downloads','Members','Votes','Service'];
function extractProduct(name='',cat=''){
  const hay=`${name} ${cat}`.toLowerCase();
  for(const w of PRODUCT_WORDS){
    const re=new RegExp(`\\b${w.toLowerCase().replace(/\s+/g,'\\s*')}\\b`,'i');
    if(re.test(hay)) return w;
  }
  if(/follow/i.test(hay)) return 'Followers';
  if(/like/i.test(hay)) return 'Likes';
  if(/view/i.test(hay)) return 'Views';
  if(/comment/i.test(hay)) return 'Comments';
  if(/sub/i.test(hay)) return 'Subscribers';
  if(/save/i.test(hay)) return 'Saves';
  if(/impression/i.test(hay)) return 'Impressions';
  if(/share/i.test(hay)) return 'Shares';
  if(/play|stream/i.test(hay)) return 'Plays';
  if(/download/i.test(hay)) return 'Downloads';
  return 'Service';
}

/* grouping helpers */
function groupByPlatform(list){const m=new Map();for(const s of list){const key=platformOf(s.category||s.name||'');if(!m.has(key))m.set(key,[]);m.get(key).push(s);}return m;}
function groupIntoBases(services){
  const bases=new Map();
  for(const s of services){
    const slug=platformOf(s.category||s.name||'');
    const product=extractProduct(s.name||'', s.category||'');
    const key=`${slug}|${product}`;
    if(!bases.has(key)) bases.set(key,{slug,product,items:[]});
    bases.get(key).items.push(s);
  }
  return bases;
}

/* render */
function render(){
  const q=(elQ.value||'').toLowerCase();
  const filtered=ALL_SERVICES.filter(s=>(`${s.name||''} ${s.title||''} ${s.category||''}`.toLowerCase().includes(q)));
  elTotal.textContent=`${filtered.length.toLocaleString()} services`;

  const byPlatform=groupByPlatform(filtered);
  elSections.innerHTML='';

  for(const [slug,arr] of byPlatform.entries()){
    const section=document.createElement('section');
    section.className='section'+(COLLAPSED.has(slug)?' collapsed':'');

    const bases=groupIntoBases(arr);
    const cards=[];
    for(const {slug:sl,product,items} of bases.values()){
      const cheapest=items.reduce((a,b)=>(a?.price_per_1k||Infinity)<(b?.price_per_1k||Infinity)?a:b,null);
      const ring=(ACCENTS[sl]||ACCENTS.other)+'55';
      const title=`${slug} ${product}`;
      // compact overview chips:
      const tags=new Set(); let minMin=Infinity,maxMax=0;
      for(const s of items){
        minMin=Math.min(minMin, s.min||Infinity); maxMax=Math.max(maxMax, s.max||0);
        for(const t of chipListForName(s.name)) tags.add(t);
        if(s.refill) tags.add('Refill'); if(s.dripfeed) tags.add('Dripfeed');
      }
      const chipLine=[]; if(isFinite(minMin)) chipLine.push(`Min ${minMin}`); if(maxMax>0) chipLine.push(`Max ${maxMax.toLocaleString()}`);
      for(const t of tags){ if(chipLine.length>=6) break; chipLine.push(t); }

      cards.push(`
        <div class="card" style="--ring:${ring};--t:${ACCENTS[sl]||ACCENTS.other}">
          <h3><span class="brand">[DropSource]</span> — ${escapeHtml(title)}</h3>
          <div class="muted">${items.length} variant${items.length>1?'s':''} available</div>
          <div class="row" style="margin:10px 0 12px">${chipLine.map(t=>`<span class="pill">${escapeHtml(t)}</span>`).join('')}</div>
          <div class="row" style="justify-content:space-between">
            <button class="btn ghost" onclick='openVariants(${JSON.stringify({slug:sl,product,title})})' style="--t:${ACCENTS[sl]||ACCENTS.other}">View variants</button>
            <button class="btn primary" onclick='openOrder(${JSON.stringify(cheapest)})' style="--t:${ACCENTS[sl]||ACCENTS.other}">Order cheapest</button>
          </div>
          <div class="price-badge">${priceFmt(cheapest)}<span class="per">/ 1k</span></div>
        </div>
      `);
    }

    section.innerHTML=`
      <div class="section-header">
        <img src="/icons/${ICON_PATHS[slug]||ICON_PATHS.other}" alt="">
        <div class="section-title">${slug}</div>
        <div class="section-meta">${arr.length.toLocaleString()} services</div>
        <div class="chev">▾</div>
      </div>
      <div class="section-body" style="${COLLAPSED.has(slug)?'display:none':''}">
        <div class="grid">${cards.join('')}</div>
      </div>
    `;
    section.querySelector('.section-header').addEventListener('click',()=>{
      if(COLLAPSED.has(slug)) COLLAPSED.delete(slug); else COLLAPSED.add(slug); render();
    });

    elSections.appendChild(section);
  }
}

/* modal: variants */
function priceFmt(s){return (typeof s?.price_per_1k==='number'&&isFinite(s.price_per_1k))?`$${s.price_per_1k.toFixed(2)}`:'-';}
function escapeHtml(x){return x?.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))||''}

function openVariants(meta){
  const {slug, product, title}=meta||{};
  modalTitle.textContent = title || 'Variants';
  variantRows.innerHTML = '';

  const variants = ALL_SERVICES.filter(s=>{
    const sl = platformOf(s.category||s.name||'');
    const prod = extractProduct(s.name||'', s.category||'');
    return sl===slug && prod===product;
  });

  for(const s of variants){
    const chips = renderQualChips(s);
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${escapeHtml(s.name||s.title||'')}</td>
      <td>${chips.map(t=>`<span class="pill">${escapeHtml(t)}</span>`).join('')}</td>
      <td>${s.min??''}</td>
      <td>${s.max?Number(s.max).toLocaleString():''}</td>
      <td>${priceFmt(s)}</td>
      <td><button class="btn primary" style="--t:${ACCENTS[slug]||ACCENTS.other}" onclick='openOrder(${JSON.stringify(s)})'>Order</button></td>
    `;
    variantRows.appendChild(tr);
  }
  modalWrap.style.display='flex';
}
modalClose.addEventListener('click',()=>modalWrap.style.display='none');
modalWrap.addEventListener('click',(e)=>{ if(e.target===modalWrap) modalWrap.style.display='none'; });

/* mock order flow (same as before) */
async function placeOrder(id,link,qty,runs,interval){
  const res=await fetch('/api/order',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({service:id,link,quantity:qty,runs,interval})});
  return res.json();
}
function openOrder(svc){
  const link=prompt('Paste the target link (post/profile URL):'); if(!link) return;
  const qty=Number(prompt(`Quantity (min ${svc.min}, max ${svc.max})`));
  if(!qty||qty<svc.min||qty>svc.max){ alert('Quantity out of range'); return; }
  placeOrder(svc.id,link,qty).then(r=>{
    if(r.error) alert('Error: '+r.error);
    else alert('Order placed! ID: '+r.order);
  }).catch(e=>alert('Network issue: '+e.message));
}

/* fetch & events */
async function fetchServices(){
  try{
    const res=await fetch('/api/smm');
    if(!res.ok) throw new Error(`API ${res.status}`);
    const data=await res.json();
    ALL_SERVICES=Array.isArray(data)?data:[];
    render();
  }catch(err){elErr.textContent='Load error: '+(err?.message||err);}
}

elQ.addEventListener('input', render);
elReload.addEventListener('click', fetchServices);
elExpandAll.addEventListener('click', ()=>{ COLLAPSED.clear(); render(); });
elCollapseAll.addEventListener('click', ()=>{
  const keys=[...groupByPlatform(ALL_SERVICES).keys()];
  COLLAPSED=new Set(keys); render();
});

/* boot */
fetchServices();
</script>
</body>
</html>