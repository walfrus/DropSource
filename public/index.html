<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DropSource — Boosts</title>
<style>
  :root{
    --bg:#0b0b0f; --card:#15161a; --txt:#e8ecf1; --muted:#a6acb3;
    --brand:#59a0ff; --rule:#26282d;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--txt);font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto}
  header{padding:24px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between;border-bottom:1px solid var(--rule)}
  .container{max-width:1100px;margin:0 auto;padding:16px}
  input,button{font:inherit}
  input{background:#11131a;border:1px solid #2a2d34;color:var(--txt);padding:10px 12px;border-radius:10px}

  /* toolbar */
  .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:8px 0 12px}
  .toolbar button{background:#0f1117;border:1px solid #2a2d34;color:var(--txt);padding:8px 12px;border-radius:10px;cursor:pointer}
  .toolbar .count{color:var(--muted);font-size:12px}

  /* sections */
  .section{border-radius:14px;overflow:hidden;margin-bottom:16px}
  .section-header{
    display:flex;align-items:center;gap:10px;padding:12px 14px;cursor:pointer;
    background:linear-gradient(180deg,#1a1b2a,#141524); border:1px solid #26273a;border-radius:14px;
  }
  .section-header img{width:18px;height:18px}
  .section-title{font-weight:600}
  .section-meta{margin-left:auto;color:var(--muted);font-size:12px}
  .chev{transition:.15s transform}
  .collapsed .chev{transform:rotate(-90deg)}
  .section-body{padding:12px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}

  /* cards */
  .card{
    position:relative;border-radius:18px;padding:18px 16px 52px;
    background:#15161a;border:1px solid #2b2d3d;
    box-shadow:0 0 0 1px rgba(255,255,255,.02) inset, 0 8px 20px rgba(0,0,0,.35);
    transition: transform .08s ease, box-shadow .12s ease, border-color .12s ease;
  }
  .card:hover{
    transform:translateY(-2px);
    border-color:#3a3d57;
    box-shadow:0 0 0 1px rgba(255,255,255,.03) inset, 0 12px 30px rgba(0,0,0,.45), 0 0 0 3px var(--ring, rgba(139,92,246,.35));
  }
  .card h3{margin:0 0 8px 0;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .muted{color:var(--muted)}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .pill{
    padding:3px 8px;border-radius:999px;font-size:12px;color:#fff;
    background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(0,0,0,.08));
    border:1px solid #2b2d3d;
  }

  /* price badge */
  .price-badge{
    position:absolute;left:14px;bottom:12px;padding:6px 10px;border-radius:10px;
    background:color-mix(in srgb,var(--t,#8b5cf6) 18%,#0f1020);
    border:1px solid color-mix(in srgb,var(--t,#8b5cf6) 30%,#343654);
    font-weight:700;box-shadow:0 4px 16px rgba(0,0,0,.4);
  }
  .price-badge .per{color:var(--muted);font-weight:500;margin-left:4px}

  /* buttons */
  .btn{
    padding:8px 12px;border-radius:10px;border:1px solid #2b2d3d;
    background:#101221;color:#e8ecf1;cursor:pointer;
    transition:filter .12s ease, transform .05s ease;
  }
  .btn:hover{filter:brightness(1.07)}
  .btn:active{transform:translateY(1px)}
  .btn.primary{
    border-color:transparent;
    background:linear-gradient(180deg,
      color-mix(in srgb,var(--t) 22%,#0f1020),
      color-mix(in srgb,var(--t) 10%,#0b0c16));
  }
  .btn.ghost{
    background:transparent;
    border-color:color-mix(in srgb,var(--t) 35%,#2b2d3d);
  }

  .footer{opacity:.7;font-size:12px;padding:18px;text-align:center}
  #err{margin-top:12px;color:#ff6b6b;font-size:12px}
</style>
</head>
<body>
<header>
  <div><strong class="brand">DropSource</strong> · Boosts</div>
  <div class="row">
    <input id="q" placeholder="Search services…"/>
    <button id="reload">Reload</button>
  </div>
</header>

<div class="container">
  <div class="toolbar">
    <button id="expandAll">Expand all</button>
    <button id="collapseAll">Collapse all</button>
    <button id="toggleView">Show variants inline</button>
    <span class="count" id="totalCount"></span>
  </div>
  <div id="sections"></div>
  <div id="err"></div>
</div>

<div class="footer">Powered by DropSource ✌️</div>

<script>
const elQ=document.getElementById('q');
const elSections=document.getElementById('sections');
const elReload=document.getElementById('reload');
const elErr=document.getElementById('err');
const elTotal=document.getElementById('totalCount');
const elExpandAll=document.getElementById('expandAll');
const elCollapseAll=document.getElementById('collapseAll');
const elToggleView=document.getElementById('toggleView');

let ALL_SERVICES=[]; let COLLAPSED=new Set(); let SHOW_VARIANTS_INLINE=false;

const ICON_PATHS={
  instagram:'instagram.svg', tiktok:'tiktok.svg', youtube:'youtube.svg', facebook:'facebook.svg',
  twitter:'specialtwitter.svg', telegram:'telegram.svg', spotify:'spotify.svg', threads:'threads.svg',
  soundcloud:'soundcloud.svg', pinterest:'pinterest.svg', reddit:'reddit.svg', linkedin:'linkedin.svg',
  twitch:'twitch.svg', vk:'vkontakte.svg', okru:'okru.svg', audiomack:'audiomack.svg',
  reverbnation:'reverbnation.svg', tidal:'tidal.svg', shazam:'shazam.svg', dailymotion:'dailymotion.svg',
  datpiff:'datpiff.svg', mixcloud:'mixcloud.svg', rumble:'rumble.svg', imdb:'imdb.svg',
  maskedtraffic:'maskedtraffic.svg', websitepremium:'websitepremium.svg', webtraffic:'webtraffic.svg',
  other:'other.svg'
};

const ACCENTS={
  instagram:'#e1306c',youtube:'#ff0033',tiktok:'#29bdb1',facebook:'#1877f2',
  twitter:'#1d9bf0',spotify:'#1db954',telegram:'#2aabee',threads:'#ffffff',
  soundcloud:'#ff5500',pinterest:'#e60023',reddit:'#ff4500',linkedin:'#0a66c2',
  twitch:'#9146ff',vk:'#4c75a3',okru:'#ed812b',audiomack:'#f2a900',reverbnation:'#e31e24',
  tidal:'#0a0a0a',shazam:'#08f',dailymotion:'#0066dc',datpiff:'#86c232',mixcloud:'#52aad8',
  rumble:'#85c742',imdb:'#f5c518',maskedtraffic:'#8b5cf6',websitepremium:'#a78bfa',webtraffic:'#8b5cf6',
  other:'#8b5cf6'
};

function platformOf(txt=''){txt=txt.toLowerCase();for(const [k,v]of Object.entries(ICON_PATHS))if(txt.includes(k))return k;return'other';}
function accentFor(s){return ACCENTS[platformOf(s.category||s.name||'')]||ACCENTS.other;}

function renderChips(s){
  const chips=[]; if(s.min)chips.push(`Min ${s.min}`); if(s.max)chips.push(`Max ${s.max}`);
  if(s.dripfeed)chips.push('Dripfeed'); if(s.refill)chips.push('Refill');
  return chips.map(t=>`<span class="pill" style="--t:${accentFor(s)}">${t}</span>`);
}

async function fetchServices(){
  try{
    const res=await fetch('/api/smm');
    if(!res.ok)throw new Error(`API ${res.status}`);
    const data=await res.json();
    ALL_SERVICES=Array.isArray(data)?data:[];
    render();
  }catch(e){elErr.textContent='Load error: '+e.message;}
}

function groupByPlatform(list){const out={};for(const s of list){const slug=platformOf(s.category||s.name||'');(out[slug]??=[]).push(s);}return out;}

function render(){
  const q=(elQ.value||'').toLowerCase();
  const groups=groupByPlatform(ALL_SERVICES.filter(s=>(s.name||'').toLowerCase().includes(q)));
  const total=ALL_SERVICES.length; elTotal.textContent=`${total.toLocaleString()} services`;

  elSections.innerHTML='';
  for(const [slug,services] of Object.entries(groups)){
    const section=document.createElement('section');
    section.className='section'+(COLLAPSED.has(slug)?' collapsed':'');
    const bodyHtml=`<div class="grid">${services.map(cardHtml).join('')}</div>`;
    section.innerHTML=`
      <div class="section-header">
        <img src="/icons/${ICON_PATHS[slug]||ICON_PATHS.other}">
        <div class="section-title">${slug}</div>
        <div class="section-meta">${services.length} services</div>
        <div class="chev">▾</div>
      </div>
      <div class="section-body" style="${COLLAPSED.has(slug)?'display:none':''}">${bodyHtml}</div>`;
    section.querySelector('.section-header').addEventListener('click',()=>{
      if(COLLAPSED.has(slug))COLLAPSED.delete(slug);else COLLAPSED.add(slug);render();
    });
    elSections.appendChild(section);
  }
}

function cardHtml(s){
  const ring=accentFor(s)+'55';
  const price=(s.price_per_1k?`$${s.price_per_1k.toFixed(2)}`:'-');
  return `<div class="card" style="--ring:${ring};--t:${accentFor(s)}">
    <h3><span class="brand">[DropSource]</span> — ${s.name}</h3>
    <div class="muted">${s.max?`Max ${s.max}`:''}</div>
    <div class="row" style="margin:10px 0 12px">${renderChips(s).join('')}</div>
    <div class="row" style="justify-content:space-between">
      <button class="btn ghost" style="--t:${accentFor(s)}">View variants</button>
      <button class="btn primary" style="--t:${accentFor(s)}">Order cheapest</button>
    </div>
    <div class="price-badge">${price}<span class="per">/1k</span></div>
  </div>`;
}

/* events */
elQ.addEventListener('input',render);
elReload.addEventListener('click',fetchServices);
elExpandAll.addEventListener('click',()=>{COLLAPSED.clear();render();});
elCollapseAll.addEventListener('click',()=>{COLLAPSED=new Set(Object.keys(groupByPlatform(ALL_SERVICES)));render();});
elToggleView.addEventListener('click',()=>{SHOW_VARIANTS_INLINE=!SHOW_VARIANTS_INLINE;render();});

/* boot */
fetchServices();
</script>
</body>
</html>